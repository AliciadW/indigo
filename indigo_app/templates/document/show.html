{% extends "main.html" %}

{% load pipeline %}
{% load static %}

{% block content %}
<div class="workspace" data-document-id="{{ document.id|default:"" }}">
  <header class="workspace-header">
    <ul class="breadcrumb text-muted">
      <li class="work-country">South Africa 路 za</li>
      <li class="work-locality">Cape Town 路 cpt</li>
      <li class="work-frbr-uri"><a href="{% url 'work' document.work.id %}">{{ document.frbr_uri }}</a></li>
    </ul>
    <div class="workspace-title">
      <h4 class="document-title">{{ document.title }}</h4>
    </div>

    <script id="breadcrumb-template" type="text/x-handlebars-template">
    {% verbatim %}
      <li class="work-country">{{ country.name }} 路 {{ document.country }}</li>
      {{#if locality}}
      <li class="work-locality">{{ locality }} 路 {{ document.locality }}</li>
      {{/if}}
      <li class="work-frbr-uri"><a href="/works/{{ work.id }}/">{{ document.frbr_uri }}</a></li>
    {% endverbatim %}
    </script>

    {% include 'document/_menu.html' %}

    <div class="workspace-buttons">
      <button class="btn btn-default save" disabled><i class="fa fa-save"></i> Save</button>
      <div id="document-activity-view"></div>

      <script id="document-activity-template" type="text/x-handlebars-template">
      {% verbatim %}

      <ul>
        {{#each activity}}
          <li class="{{#if is_asleep }}is-asleep{{/if}} user-{{ user.colour }}" title="{{ user.display_name }} is also editing">
            <i class="fa fa-user"></i> {{ user.display_name }}
          </li>
        {{/each}}
      </ul>
      {% endverbatim %}
      </script>
    </div>
  </header>

  <div class="workspace-body">

    {% include "document/_sidebar.html" %}

    <div class="workspace-content">
      <div class="tab-content high">
        <div id="props-tab" class="tab-pane active high">
          {% include "document/_properties.html" %}
        </div>

        <div id="amendments-tab" class="tab-pane high">
          {% include "document/_amendments.html" %}
        </div>

        <div id="attachments-tab" class="tab-pane high">
          {% include "document/_attachments.html" %}
        </div>

        <div id="content-tab" class="tab-pane high">
          {% include "document/_content.html" %}
        </div>

        <div id="preview-tab" class="tab-pane high">
          {% include "document/_preview.html" %}
        </div>
      </div>
    </div>

    {% include "document/_defined_terms.html" %}
    {% include "document/_references.html" %}
    {% include "document/_revisions.html" %}
    {% include "document/_annotations.html" %}
    {% include "document/_insert_image_modal.html" %}
    {% include "document/_document_chooser_modal.html" %}
    {% include "document/_cheatsheet.html" %}
    {% include "work/_work_chooser_modal.html" %}
  </div>
</div>
{% endblock %}

{% block js %}
  {{ block.super }}
  <script type="text/javascript" src="/static/javascript/ace/ace.js"></script>

  {# include the document as JSON #}
  <script type="text/javascript">
  // inject country code-to-name mappings into JS
  window.Indigo.countries = {{ countries_json|safe }};

  window.Indigo.Preloads.document = {{ document_json|safe }};
  window.Indigo.Preloads.documentContent = {{ document_content_json|safe }};
  window.Indigo.Preloads.work = {{ work_json|safe }};
  window.Indigo.Preloads.works = {{ works_json|safe }};
  window.Indigo.Preloads.amendments = {{ amendments_json|safe }};

  window.Indigo.Preloads.library = {{ documents_json|safe }};

  CKEDITOR_BASEPATH = '/static/ckeditor/';
  </script>

  <script type="text/javascript" src="{% static 'ckeditor/ckeditor.js' %}"></script>

{% endblock %}
