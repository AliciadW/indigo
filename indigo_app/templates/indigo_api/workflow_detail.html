{% extends "place/tabbed_layout.html" %}
{% load activity_tags %}
{% load humanize indigo_app %}

{% block title %}{{ workflow.title }}{% endblock %}

{% block content %}
<div class="container mt-3 mb-5">
  <div class="float-right">
    <a href="{% url 'workflow_edit' place=place.place_code pk=workflow.pk %}" class="btn btn-primary">Edit workflow</a>
  </div>

  <div class="d-flex">
    <div class="float-left mr-3 text-center">
      <span class="text-muted">#{{ workflow.pk }}</span>
    </div>

    <div class="float-left">
      <h5>{{ workflow.title }}</h5>
    </div>
  </div>

  <div class="card mt-3">
    <div class="card-body">

      <p>{{ workflow.description|linebreaks }}</p>

      {% for task in workflow.tasks.all %}
      <div>
        <a href="{% url 'task_detail' place=place.place_code pk=task.pk %}">{{ task.title }}</a>
        {% if task.work %}– <a href="{% url 'work' frbr_uri=task.work.frbr_uri %}">{{ task.work.title }}</a>
        {% if task.document %}– <a href="{% url 'document' doc_id=task.document.pk %}">@ {{ task.document.expression_date }}</a>{% endif %}{% endif %}
        {% if task.description %}– <span class="font-weight-normal">{{ task.description }}</span>{% endif %}
      </div>
      {% endfor %}
    </div>

  </div>

  <ul class="activity-list">
    {% activity_stream 'action_object' workflow %}
    {% for action in stream reversed %}
    <li class="activity-item">{% user_profile action.actor %} {{ action.verb }} this workflow {{ action.timestamp|naturaltime }}</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
