{% extends "main.html" %}

{% block title %}Library{% endblock %}

{% block view-id %}library-view{% endblock %}
{% block main-header %}{% endblock %}
{% block content %}
<aside class="library-sidebar">
  <section>
    <label>Country</label>
    <select class="form-control filter-country" name="country-filter">
      {% for country in countries %}
        <option {% if country_code == country.code %}selected{% endif %} value="{{country.code}}">{{country.name}}</option>
      {% endfor %}
    </select>
  </section>

  <div id="filters"></div>
</aside>

<div class="library-wrapper">
  <div class="library-filter-box">
    <input type="text" class="form-control filter-search" placeholder="Filter by title, year or number">
  </div>

  <div id="library"></div>
</div>
{% endblock %}

{% block js %}
{{ block.super }}

<script id="search-results-template" type="text/x-handlebars-template">
{% verbatim %}

<table class="table table-sm table-hover document-list-table sorted-table">
  <thead>
    <tr>
      <th class="title" data-sort="title">Title</th>
      <th class="title" data-sort="title">Frbr uri</th>
      <th class="title" data-sort="title">Languages</th>
      <th class="title" data-sort="title">Points in time</th>
      <!--<th class="title" data-sort="title">Workflows</th>-->
      <th class="title" data-sort="title">Number of drafts</th>
    </tr>
  </thead>

  <tbody>
    {{#each works}}
      <tr>
        <td>
          {{#if docs}}
            <i class="fa fa-fw fa-circle published" title="published"></i>
          {{else}}
            <i class="fa fa-fw fa-circle" title="empty work"></i>
          {{/if}}
          <a href="/works{{ frbr_uri }}/">{{ title }}</a>
          {{#if repealed}}
            <span class="badge badge-info">repealed</span>
          {{/if}}
        </td>
        <td>
          {{ frbr_uri }}
        </td>
        <td>
          {{#if docs}}
            {{#each docs}}
              {{ language }}
            {{/each}}
          {{/if}}
        </td>
        <td>
          {{#if docs}}
            <a href="/works{{ frbr_uri }}/amendments/">
              {{#each docs}}
                1
              {{/each}}
            </a>
          {{/if}}
        </td>
        <td>
          {{#if docs}}
            {{#each docs}}
              {{#if draft}}
                1
              {{/if}}
            {{/each}}
          {{/if}}
        </td>
      </tr>
    {{/each}}
  </tbody>

  <tfoot>
    <tr>
      <td class="active" colspan="5">{{ count }} works</td>
    </tr>
  </tfoot>
</table>
{% endverbatim %}

</script>

<script id="filters-template" type="text/x-handlebars-template">
{% verbatim %}

{{#if summary.localities}}
<section>
  <label>Locality</label>
  <select class="form-control filter-locality" name="locality-filter">
    {{#each summary.localities}}
      <option {{#if active}}selected{{/if}} value="{{code}}">{{name}} ({{count}})</option>
    {{/each}}
  </select>
</section>
{{/if}}

<section>
  <label>Nature</label>
  <select class="form-control filter-nature" name="nature-filter">
    {{#each summary.natures}}
      <option {{#if active}}selected{{/if}} value="{{nature}}">{{name}} ({{count}})</option>
    {{/each}}
  </select>
</section>

<section>
  <div class="btn-group btn-group-toggle" data-toggle="buttons">
    <label class="btn btn-sm {{#if filter_status.all}}btn-secondary active{{/if}}">
      <input type="radio" name="options" autocomplete="off" class="filter-status" value="all" checked>All
    </label>
    <label class="btn btn-sm {{#if filter_status.published}}btn-info active{{else}}btn-default{{/if}}">
      <input type="radio" name="options" autocomplete="off" class="filter-status" value="published"><i class="fa fa-fw fa-circle published"></i>Published
    </label>
    <label class="btn btn-sm {{#if filter_status.draft}}btn-warning active{{else}}btn-default{{/if}}">
      <input type="radio" name="options" autocomplete="off" class="filter-status" value="draft"><i class="fa fa-fw fa-circle draft"></i>Draft
    </label>
  </div>
</section>

<section class="tag-filters">
  {{#each summary.tags}}
  <a href="#" class="badge {{#if active}}badge-info{{else}}badge-secondary{{/if}} filter-tag" data-tag="{{this.tag}}">{{this.tag}} <span class="badge badge-pill badge-light">{{this.count}}</span></a>
  {{/each}}
</section>
{% endverbatim %}
</script>

<script type="text/javascript">
// inject country code-to-name mappings into JS
window.Indigo.countries = {{ countries_json|safe }};

// include the documents as JSON
window.Indigo.Preloads.country_code = '{{ country_code }}';
window.Indigo.Preloads.works = {{ works_json|safe }};
window.Indigo.Preloads.library = {{ documents_json|safe }};
</script>
{% endblock %}}
