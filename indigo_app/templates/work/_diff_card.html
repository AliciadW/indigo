<div class="card mb-3">
  <div class="card-body">
    <a href="#{{ version.id }}-changes" data-toggle="collapse" class="pull-right">{{ version.changes|length }} change{{ version.changes|length|pluralize}}</a>
    <div>
      <span class="time-ago" data-timestamp="{{ version.revision.date_created|date:'c' }}">{{ version.revision.date_created|date:"Y-m-d H:i" }}</span>
      by {{ version.revision.user }}
    </div>

    <div class="mt-3 collapse" id="{{ version.id }}-changes">
      <table class="table table-sm table-borderless diff-table">
      {% for changed in version.changes %}
        <tr>
          <th colspan="2">{{ changed.field|title }}</th>
          <th class="text-muted">
            {% if forloop.first %}
              {% if current %}Current version{% else %}Version #{{ version.id }}{% endif %}
            {% endif %}
          </th>
        </tr><tr>
          <td style="width: 48%">{{ changed.old }}</td>
          <td style="width: 4%" class="text-center">â†’</td>
          <td style="width: 48%">{{ changed.new }}</td>
        </tr>
      {% endfor %}

      {% if version.previous and perms.indigo_api.change_work %}
        <tr>
          <td class="pt-3">
            <form action="{% url 'work_restore_version' frbr_uri=work.frbr_uri version_id=version.previous.id %}" method="POST">
              {% csrf_token %}
              <button type="submit" class="btn btn-warning" data-confirm="Are you sure?">Restore this version</button>
            </form>
          </td>
        </tr>
      {% endif %}
      </table>

    </div>
  </div>
</div>
