{% extends "work/layout.html" %}

{% block view-id %}work-amendments-view{% endblock %}

{% block subnav %}
  {% if perms.indigo_api.can_change_amendment %}
  <button class="btn btn-info save-work pull-right" type="button">Save</button>
  {% endif %}

  <ul class="nav nav-tabs">
    <li role="presentation"><a href="{% url 'work' work_id=work.id %}">Work Details</a></li>
    <li role="presentation" class="active"><a href="{% url 'work_amendments' work_id=work.id %}">Amendments</a></li>
  </ul>
{% endblock %}

{% block work-content %}
  <h3>Amendments to this work</h3>

  <div class="work-amendments"></div>

  <script id="work-amendments-template" type="text/x-handlebars-template">
  {% verbatim %}

  <div class="amendment-expressions">
      <ol class="expression-timeline">
      {{#each amendments}}
        <li class="item">
          {{#unless ../readonly}}
          <div class="dropdown pull-right">
            <button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown">Edit <span class="caret"></span></button>
            <ul class="dropdown-menu">
              <li><a href="#" class="edit-amendment" data-index="{{ @index }}">Change date</a></li>
              <li><a href="#" class="delete-amendment" data-index="{{ @index }}">Delete</a></li>
            </ul>
          </div>
          {{/unless}}
          <div class="edit-wrapper"></div>

          <h5 class="date">{{ date }}</h5>

          <h5><a href="/works/{{ work.id }}">{{ amending_work.title }}</a></h5>
          <h6>{{ amending_work.frbr_uri }}</h6>

          <div class="documents">
            {{#if documents}}
              {{#each documents}}
                <a href="/documents/{{ id }}">{{ title }}</a>
              {{/each}}
            {{else}}
              <span class="text-muted">No editable version at this date</span>
              â€”
              <a href="#" class="create-expression" data-date="{{ date }}">create and edit an amended version</a>
            {{/if}}
          </div>
        </li>
      {{/each}}
      <li>
        <button class="btn btn-default add-amendment"><i class="fa fa-plus"></i> Add amendment</button>
      </li>
    </ol>
  </div>

  {% endverbatim %}
  </script>

  <script id="amendment-editor-template" type="text/x-handlebars-template">
  {% verbatim %}
  <div class="form-inline">
    <input type="text" class="form-control amendment-date" data-provide="datepicker" placeholder="yyyy-mm-dd" pattern="\d{4}-\d\d-\d\d" required>
    <button class="btn btn-link cancel">Cancel</button>
    <button class="btn btn-primary save-amendment">OK</button>
  </div>
  {% endverbatim %}
  </script>
{% endblock %}

{% block js %}
  {{ block.super }}

  {# include the document as JSON #}
  <script type="text/javascript">
  window.Indigo.Preloads.amendments = {{ amendments_json|safe }};
  window.Indigo.Preloads.documents = {{ documents_json|safe }};
  </script>

{% endblock %}
