{% extends "work/layout.html" %}

{% block view-id %}work-amendments-view{% endblock %}

{% block subnav %}
  {% if perms.indigo_api.can_change_amendment %}
  <button class="btn btn-info save-work pull-right" type="button">Save</button>
  {% endif %}

  <ul class="nav nav-tabs">
    <li role="presentation"><a href="{% url 'work' work_id=work.id %}">Work Details</a></li>
    <li role="presentation" class="active"><a href="{% url 'work_amendments' work_id=work.id %}">Amendments</a></li>
  </ul>
{% endblock %}

{% block work-content %}
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Amendments to this work</h3>
    </div>
    <div class="work-amendments"></div>
  </div>

  <script id="work-amendments-template" type="text/x-handlebars-template">
  {% verbatim %}

  <table class="table table-striped">
    <thead>
      <tr>
        <th class="date">Date</th>
        <th colspan="3">Amending work</th>
      </tr>
    </thead>
    <tbody>
    {{#each amendments}}
      <tr data-index="{{ @index }}">
        <td>{{ date }}</td>
        <td><a href="/works/{{ work.id }}">{{ amending_work.title }}</a></td>
        <td>{{ amending_work.frbr_uri }}</td>
        <td class="text-right">
          {{#unless ../readonly}}
          <a href="#" class="edit-amendment">change</a> Â· <a href="#" class="delete-amendment">delete</a>
          {{/unless}}
        </td>
      </tr>
    {{/each}}
    {{#unless readonly}}
      <tr>
        <td colspan="4">
          <button class="btn btn-default add-amendment"><i class="fa fa-plus"></i> Add amendment</button>
        </td>
      </tr>
    {{/unless}}
    </tbody>
  </table>

  {% endverbatim %}
  </script>

  <script id="amendment-editor-template" type="text/x-handlebars-template">
  {% verbatim %}
  <td>
    <input type="text" class="form-control amendment-date" data-provide="datepicker" placeholder="yyyy-mm-dd" pattern="\d{4}-\d\d-\d\d" required>
  </td>
  <td>{{ amending_work.title }}</td>
  <td>{{ amending_work.frbr_uri }}</td>
  <td class="text-right">
    <button class="btn btn-link cancel">Cancel</button>
    <button class="btn btn-primary save-amendment">OK</button>
  </td>
  {% endverbatim %}
  </script>
{% endblock %}

{% block js %}
  {{ block.super }}

  {# include the document as JSON #}
  <script type="text/javascript">
  window.Indigo.Preloads.amendments = {{ amendments_json|safe }};
  window.Indigo.Preloads.documents = {{ documents_json|safe }};
  </script>

{% endblock %}
