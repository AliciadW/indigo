{% extends "main.html" %}

{% block title %}{% if work %}{{ work.title }}{% else %}Work{% endif %}{% endblock %}
{% block header %}<h4>{% if work %}{{ work.title }}{% else %}Create a new work{% endif %}</h4>{% endblock %}

{% block content %}
<main id="main-content" class="container">
  <div id="work-amendments-view">
    <ul class="breadcrumb">
      <li class="work-country">{{ country.name }} · {{ country.code }}</li>
      {% if locality %}
      <li class="work-locality">{{ locality.name }} · {{ locality.code }}</li>
      {% endif %}
    </ul>

    <header>
      <button class="btn btn-info save-work pull-right" type="button">Save</button>

      <h3 class="work-title">{{ work.title }}</h3>
      <h5 class="work-frbr-uri text-muted">{{ work.frbr_uri }}</h3>
    </header>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Amendments to this work</h3>
      </div>
      <div class="work-amendments"></div>
    </div>

  </div>
</div>

<script id="work-amendments-template" type="text/x-handlebars-template">
{% verbatim %}

<table class="table table-striped">
  <thead>
    <tr>
      <th class="date">Date</th>
      <th colspan="3">Amending work</th>
    </tr>
  </thead>
  <tbody>
  {{#each amendments}}
    <tr data-index="{{ @index }}">
      <td>{{ date }}</td>
      <td><a href="/works/{{ work.id }}">{{ work.title }}</a></td>
      <td>{{ work.frbr_uri }}</td>
      <td class="text-right">
        <a href="#" class="edit-amendment">change</a> · <a href="#" class="delete-amendment">delete</a>
      </td>
    </tr>
  {{/each}}
    <tr>
      <td colspan="4">
        <button class="btn btn-default add-amendment"><i class="fa fa-plus"></i> Add amendment</button>
      </td>
    </tr>
  </tbody>
</table>

{% endverbatim %}
</script>

<script id="amendment-editor-template" type="text/x-handlebars-template">
{% verbatim %}
<td>
  <input type="text" class="form-control amendment-date" data-provide="datepicker" placeholder="yyyy-mm-dd" pattern="\d{4}-\d\d-\d\d" required>
</td>
<td>{{ work.title }}</td>
<td>{{ work.frbr_uri }}</td>
<td class="text-right">
  <button class="btn btn-link cancel">Cancel</button>
  <button class="btn btn-primary save-amendment">OK</button>
</td>
{% endverbatim %}
</script>

{% include "work/_work_chooser_modal.html" %}

{% endblock %}

{% block js %}
  {{ block.super }}

  {# include the document as JSON #}
  <script type="text/javascript">
  // inject country code-to-name mappings into JS
  window.Indigo.countries = {{ countries_json|safe }};
  window.Indigo.Preloads.country_code = '{{ user.editor.country_code }}';
  window.Indigo.Preloads.country = {{ countries_json|safe }};
  window.Indigo.Preloads.work = {{ work_json|safe }};
  </script>

{% endblock %}
