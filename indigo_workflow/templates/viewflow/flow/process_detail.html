{% extends 'main.html' %}
{% load i18n viewflow indigo_workflow %}

{% block content %}
<div class="container pt-3 pb-3">

  <div class="card mb-3">
    <div class="card-header">
      {% block card-header %}
        {% include 'indigo_workflow/_process_header.html' with process=process %}
      {% endblock %}
    </div>
    <div class="card-body">
      {% block card-body %}
        <p class="lead">{{ process.summary }}</p>

        <h5>Tasks</h5>

        <ol>
          {% for task in task_list %}
            {% if task.flow_task_type == 'HUMAN' %}
            <li>
              <p><a href="{% flowurl task user=request.user %}">{{ task.summary|default:task.flow_task }}</a> - {{ task.get_status_display }}
              {{ task.owner|default:"(no owner)" }}</p>

              <form role="form" method="POST">
                {% csrf_token %}

                {% flowurl task 'assign' user=request.user as assign_url %}
                {% if assign_url %}
                <button type="submit" name="_continue" class="btn btn-primary" formaction="{{ assign_url }}">{% trans 'Assign and continue on this process' %}</button>
                {% endif %}

                {% flowurl task 'unassign' user=request.user as unassign_url %}
                {% if unassign_url %}
                <button type="submit" name="run_action" class="btn btn-danger" formaction="{{ unassign_url }}">{% trans 'Unassign' %}</button>
                {% endif %}
              </form>

              {% flowurl task 'execute' user=request.user as execute_url %}
              {% if execute_url %}
              <a href="{{ execute_url }}" class="btn btn-primary">{% trans 'Execute' %}</a>
              {% endif %}

            </li>
            {% endif %}
          {% endfor %}
        </ol>
      {% endblock %}
    </div>
    <div class="card-footer">
      <div class="row">
        <div class="col">
          {% if process.finished %}
            <div class="text-muted">Finished in {{ process.created|timesince:process.finished }}.</div>
          {% endif %}
        </div>
        <div class="col text-right">
          {% if view.flow_class|manage_permission_name in perms and process.status == 'NEW' %}
            <a class="btn btn-danger" href="{% flowurl process 'action_cancel' %}">{% trans 'Cancel workflow' %}</a>
          {% endif %}
        </div>
      </div>

    </div>
  </div>

</div>
{% endblock %}
